# ğŸ“Š PIZZA-MONITOR: System Diagrams

## 1. System Architecture Diagram

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    PIZZA-MONITOR MICROSERVICES SYSTEM                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          INPUT LAYER                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ VIDEO FILES                                                          â”‚  â”‚
â”‚  â”‚ ./videos/Sah w b3dha ghalt.mp4 , Sah w b3dha ghalt (2).mp4 , Sah w b3dha ghalt (3).mp4                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â†“                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FRAME READER SERVICE (Python + OpenCV)                              â”‚  â”‚
â”‚  â”‚ â€¢ Read video files                                                   â”‚  â”‚
â”‚  â”‚ â€¢ Extract frames                               â”‚  â”‚
â”‚  â”‚ â€¢ Encode to JPEG                                       â”‚  â”‚
â”‚  â”‚ â€¢ Publish to RabbitMQ                                               â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  Input: Video File                                                  â”‚  â”‚
â”‚  â”‚  Output: Frame + Metadata (JSON)                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  RabbitMQ Message Broker (AMQP)                         â”‚
           â”‚  Exchange: detection_exchange                           â”‚
           â”‚  Routing Key: frame                                     â”‚
           â”‚  Queue: detection_queue                                 â”‚
           â”‚  âœ“ Durable  âœ“ Persistent Messages                       â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       PROCESSING LAYER                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ DETECTION SERVICE (Python + PyTorch + YOLO12m)                       â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ 1. Consume Frame from RabbitMQ                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Decode Base64 JPEG                                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Load into OpenCV (BGR format)                             â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                          â†“                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ 2. YOLO12m Inference                                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Load model weights (yolo12m-v2.pt)                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Run detection (confidence: 0.3, IoU: 0.45)                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Register custom modules (A2C2f, C3k2)                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Output: Class + Confidence + BBox                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    Detection Classes:                                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ hand         (red)                                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ pizza        (yellow)                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ scooper      (green)                                      â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                          â†“                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ 3. Violation Detection Logic                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    for each detected HAND:                                     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚        if hand.bbox in ROI:                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚            if NOT hand.overlaps(scooper):                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                if hand.overlaps(pizza):                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                    VIOLATION DETECTED! âš ï¸                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    ROI: Region of Interest (configurable)                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    Overlap Check: IoU threshold 0.1                            â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                          â†“                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ 4. Store in PostgreSQL (if violation)                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Video name, frame ID, timestamp                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Violation type, bounding boxes                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Detected objects, confidence scores                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Frame file path for reference                             â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                          â†“                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ 5. Publish Results to RabbitMQ                                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Detection metadata                                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Violation count                                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚    â€¢ Object class and confidence                               â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  Configuration:                                                      â”‚  â”‚
â”‚  â”‚  â€¢ Confidence threshold: 0.3                                        â”‚  â”‚
â”‚  â”‚  â€¢ IoU threshold: 0.45                                             â”‚  â”‚
â”‚  â”‚  â€¢ Device: CPU (or CUDA if available)                              â”‚  â”‚
â”‚  â”‚  â€¢ Model path: /models/yolo12m-v2.pt                               â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PostgreSQL Database (Persistence)                                   â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  violations TABLE:                                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ id (PRIMARY KEY)                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ video_name (indexed)                                            â”‚  â”‚
â”‚  â”‚  â”œâ”€ frame_id                                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ timestamp (indexed)                                             â”‚  â”‚
â”‚  â”‚  â”œâ”€ violation_type                                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ bounding_boxes (JSONB)                                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ detected_objects (JSONB)                                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ confidence (JSONB)                                              â”‚  â”‚
â”‚  â”‚  â””â”€ created_at (TIMESTAMP)                                          â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  Storage: ~1MB per 1000 violations                                  â”‚  â”‚
â”‚  â”‚  Backup: Daily snapshots recommended                                â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  RabbitMQ Message Broker (AMQP)                         â”‚
           â”‚  Exchange: detection_results                            â”‚
           â”‚  Routing Key: detections                                â”‚
           â”‚  Queue: streaming_results_queue                         â”‚
           â”‚  âœ“ Durable  âœ“ Persistent Messages                       â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STREAMING LAYER                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ STREAMING SERVICE (Python + Flask)                                  â”‚  â”‚
â”‚  â”‚ â€¢ REST API Server (:5000)                                           â”‚  â”‚
â”‚  â”‚ â€¢ RabbitMQ Consumer (background thread)                             â”‚  â”‚
â”‚  â”‚ â€¢ In-memory cache of latest detections                              â”‚  â”‚
â”‚  â”‚ â€¢ PostgreSQL query interface                                        â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  Endpoints:                                                         â”‚  â”‚
â”‚  â”‚  GET /api/health                          â†’ Health status           â”‚  â”‚
â”‚  â”‚  GET /api/violations/<video_name>         â†’ Get violations          â”‚  â”‚
â”‚  â”‚  GET /api/violations-list                 â†’ List all videos         â”‚  â”‚
â”‚  â”‚  GET /api/latest-detection/<video_name>   â†’ Latest frame           â”‚  â”‚
â”‚  â”‚  GET /api/video-summary/<video_name>      â†’ Summary stats           â”‚  â”‚
â”‚  â”‚  GET /api/violation-details/<id>          â†’ Detail info             â”‚  â”‚
â”‚  â”‚  GET /api/statistics                      â†’ Overall stats           â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  In-Memory Cache:                                                   â”‚  â”‚
â”‚  â”‚  {                                                                  â”‚  â”‚
â”‚  â”‚    "video_1": {frame_data, detections, violation_count},            â”‚  â”‚
â”‚  â”‚    "video_2": {frame_data, detections, violation_count}             â”‚  â”‚
â”‚  â”‚  }                                                                  â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“                                  â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PostgreSQL Database  â”‚      â”‚  Frontend (Nginx)     â”‚
        â”‚  (Persistent Store)   â”‚      â”‚  (Web Dashboard)      â”‚
        â”‚  :5432                â”‚      â”‚  :3000                â”‚
        â”‚                       â”‚      â”‚                       â”‚
        â”‚  Query historical     â”‚      â”‚  HTTP GET /api/*      â”‚
        â”‚  violation data       â”‚      â”‚  â”‚                    â”‚
        â”‚                       â”‚      â”‚  Proxy to Streaming   â”‚
        â”‚  SELECT * FROM        â”‚      â”‚  Render UI            â”‚
        â”‚  violations WHERE...  â”‚      â”‚  Display results      â”‚
        â”‚                       â”‚      â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â†“
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚  User Browser      â”‚
                                      â”‚  View detections   â”‚
                                      â”‚  Monitor violationsâ”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Message Flow Diagram

```
TIME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’

Frame Reader               Detection Service            Streaming Service
      â”‚                           â”‚                            â”‚
      â”‚  1. Read Video Frame      â”‚                            â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                            â”‚
      â”‚  2. Publish to RabbitMQ   â”‚                            â”‚
      â”‚     (detection_exchange)  â”‚                            â”‚
      â”‚                           â”‚                            â”‚
      â”œâ”€ - - - - - - - - - - - - >â”‚                            â”‚
      â”‚                           â”‚                            â”‚
      â”‚                  3. Consume Frame                       â”‚
      â”‚                  from Queue                            â”‚
      â”‚                  (detection_queue)                     â”‚
      â”‚                           â”‚                            â”‚
      â”‚                  4. YOLO Inference                      â”‚
      â”‚                  (100-200ms)                           â”‚
      â”‚                           â”‚                            â”‚
      â”‚                  5. Violation Check                     â”‚
      â”‚                  (5-10ms)                              â”‚
      â”‚                           â”‚                            â”‚
      â”‚                  6. Store to PostgreSQL                 â”‚
      â”‚                  (50ms)                                â”‚
      â”‚                           â”‚                            â”‚
      â”‚                  7. Publish Results                     â”‚
      â”‚                  (detection_results)                   â”‚
      â”‚                           â”œâ”€ - - - - - - - - - - - - >â”‚
      â”‚                           â”‚                            â”‚
      â”‚                           â”‚              8. Consume Results
      â”‚                           â”‚              from Queue
      â”‚                           â”‚              (streaming_results_queue)
      â”‚                           â”‚                            â”‚
      â”‚                           â”‚              9. Update In-Memory Cache
      â”‚                           â”‚                 (instant)
      â”‚                           â”‚                            â”‚
      â”‚                           â”‚              10. Aggregate Statistics
      â”‚                           â”‚                            â”‚
      â”‚  (Next Frame)             â”‚                            â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                            â”‚
      â”‚                           â”‚                  11. User polls API
      â”‚                           â”‚                  GET /api/latest
      â”‚                           â”‚                  â†- - - - - - - - - - â”€â”¤
      â”‚                           â”‚                            â”‚
      â”‚                           â”‚                  12. Return JSON Response
      â”‚                           â”‚                  (from cache, instant)
      â”‚                           â”‚                  - - - - - - - - - - ->â”‚

Latency Breakdown (per frame):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frame Extraction:        ~20ms                                  â”‚
â”‚ Network (RabbitMQ):       ~5ms                                  â”‚
â”‚ YOLO Inference:         ~150ms (CPU) / ~50ms (GPU)            â”‚
â”‚ Violation Logic:          ~5ms                                  â”‚
â”‚ Database Insert:         ~50ms (per violation)                  â”‚
â”‚ Network (RabbitMQ):       ~5ms                                  â”‚
â”‚ Cache Update:             ~1ms                                  â”‚
â”‚ API Response:             <1ms                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL E2E:            ~175-235ms                               â”‚
â”‚ Throughput:           ~5-6 frames/second (with 5 FPS setting)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Data Structure Diagram

```
RabbitMQ Frame Message:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                           â”‚
â”‚   "frame_id": 150,                          â”‚
â”‚   "video_name": "video_1",                  â”‚
â”‚   "timestamp": 5000,                        â”‚
â”‚   "frame": "BASE64_ENCODED_JPEG",           â”‚
â”‚   "height": 720,                            â”‚
â”‚   "width": 1280,                            â”‚
â”‚   "frame_path": "/tmp/frames/..."           â”‚
â”‚ }                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

YOLO Detection Output:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [                                           â”‚
â”‚   {                                         â”‚
â”‚     "class": "hand",                        â”‚
â”‚     "confidence": 0.95,                     â”‚
â”‚     "bbox": [100, 150, 200, 300],           â”‚
â”‚     "area": 15000                           â”‚
â”‚   },                                        â”‚
â”‚   {                                         â”‚
â”‚     "class": "pizza",                       â”‚
â”‚     "confidence": 0.92,                     â”‚
â”‚     "bbox": [120, 160, 280, 320],           â”‚
â”‚     "area": 25600                           â”‚
â”‚   },                                        â”‚
â”‚   {                                         â”‚
â”‚     "class": "scooper",                     â”‚
â”‚     "confidence": 0.87,                     â”‚
â”‚     "bbox": [250, 140, 300, 220],           â”‚
â”‚     "area": 4000                            â”‚
â”‚   }                                         â”‚
â”‚ ]                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PostgreSQL Violation Record:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id: 1                                                    â”‚
â”‚ video_name: "video_1"                                   â”‚
â”‚ frame_id: 150                                           â”‚
â”‚ timestamp: 5000                                         â”‚
â”‚ violation_type: "hand_no_scooper"                       â”‚
â”‚ bounding_boxes: {                                       â”‚
â”‚   "hand": [100, 150, 200, 300],                         â”‚
â”‚   "pizza": [120, 160, 280, 320]                         â”‚
â”‚ }                                                       â”‚
â”‚ detected_objects: ["hand", "pizza", "scooper"]         â”‚
â”‚ confidence: [0.95, 0.92, 0.87]                         â”‚
â”‚ frame_path: "/tmp/frames/video_1_150.jpg"              â”‚
â”‚ created_at: 2025-12-26 10:30:45.123                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

REST API Response (GET /api/violations/video_1):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                                        â”‚
â”‚   "video_name": "video_1",                              â”‚
â”‚   "total_violations": 5,                                â”‚
â”‚   "violations": [                                       â”‚
â”‚     {                                                   â”‚
â”‚       "id": 1,                                          â”‚
â”‚       "frame_id": 150,                                  â”‚
â”‚       "timestamp": 5000,                                â”‚
â”‚       "violation_type": "hand_no_scooper",              â”‚
â”‚       "bounding_boxes": {...},                          â”‚
â”‚       "detected_objects": [...],                        â”‚
â”‚       "created_at": "2025-12-26T10:30:45.123Z"         â”‚
â”‚     },                                                  â”‚
â”‚     ... more violations ...                             â”‚
â”‚   ]                                                     â”‚
â”‚ }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Service Dependencies Diagram

```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   PostgreSQL    â”‚
                          â”‚   Database      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                             â”‚
                    â†“                             â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Detection   â”‚          â”‚    Streaming     â”‚
            â”‚  Service     â”‚          â”‚    Service       â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                           â”‚
                   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                   â”œâ”€â”€â”€â†’â”‚   RabbitMQ      â”‚â†â”€â”€â”€â”¤
                   â”‚    â”‚   Message       â”‚    â”‚
                   â”‚    â”‚   Broker        â”‚    â”‚
                   â””â”€â”€â”€â†’â”‚                 â”‚â†â”€â”€â”€â”˜
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                  â”‚                  â”‚
              â†“                  â†“                  â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Frame   â”‚      â”‚  Frontend  â”‚    â”‚  External    â”‚
        â”‚  Reader  â”‚      â”‚  (Nginx)   â”‚    â”‚  Systems     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Connection Statistics:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frame Reader â†’ RabbitMQ:     1 producer                â”‚
â”‚ Detection â† RabbitMQ:         N consumers (scalable)   â”‚
â”‚ Detection â†” PostgreSQL:       N concurrent connectionsâ”‚
â”‚ Detection â†’ RabbitMQ:         1 producer               â”‚
â”‚ Streaming â† RabbitMQ:         1 consumer               â”‚
â”‚ Streaming â†” PostgreSQL:       Connection pool (5-20)   â”‚
â”‚ Streaming â†’ Clients:          Multiple concurrent      â”‚
â”‚ Frontend â†’ Streaming:         HTTP REST calls          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Container & Network Architecture

```
Docker Network: pizza_network
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  rabbitmq:5672   â”‚      â”‚  db:5432         â”‚                â”‚
â”‚  â”‚  rabbitmq:15672  â”‚      â”‚                  â”‚                â”‚
â”‚  â”‚  (Management UI) â”‚      â”‚  PostgreSQL 15   â”‚                â”‚
â”‚  â”‚                  â”‚      â”‚                  â”‚                â”‚
â”‚  â”‚  âœ“ Health Check  â”‚      â”‚  âœ“ Health Check  â”‚                â”‚
â”‚  â”‚  âœ“ Auto Restart  â”‚      â”‚  âœ“ Auto Restart  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚          â†‘                           â†‘                           â”‚
â”‚          â”‚ AMQP                      â”‚ PostgreSQL                â”‚
â”‚          â”‚ :5672                     â”‚ :5432                     â”‚
â”‚          â”‚                           â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                     â”‚                        â”‚               â”‚
â”‚  â†“                     â†“                        â†“               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚  detection   â”‚  â”‚  streaming   â”‚  â”‚  frame_reader    â”‚       â”‚
â”‚ â”‚  :5672 (out) â”‚  â”‚  :5000       â”‚  â”‚  :5672 (out)     â”‚       â”‚
â”‚ â”‚  :5432 (out) â”‚  â”‚  :5000 (in)  â”‚  â”‚                  â”‚       â”‚
â”‚ â”‚              â”‚  â”‚  :5432 (out) â”‚  â”‚  Reads:          â”‚       â”‚
â”‚ â”‚  YOLO12m     â”‚  â”‚              â”‚  â”‚  /videos (mount) â”‚       â”‚
â”‚ â”‚  /models     â”‚  â”‚  Flask REST  â”‚  â”‚                  â”‚       â”‚
â”‚ â”‚  (mount)     â”‚  â”‚  API Server  â”‚  â”‚                  â”‚       â”‚
â”‚ â”‚              â”‚  â”‚              â”‚  â”‚                  â”‚       â”‚
â”‚ â”‚  âœ“ Restart   â”‚  â”‚  âœ“ Restart   â”‚  â”‚  âœ“ Restart       â”‚       â”‚
â”‚ â”‚    unless    â”‚  â”‚    unless    â”‚  â”‚    unless        â”‚       â”‚
â”‚ â”‚    stopped   â”‚  â”‚    stopped   â”‚  â”‚    stopped       â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚          â†‘               â†‘                    â†‘                  â”‚
â”‚          â”‚               â”‚                    â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚         Internet (Port Mappings)                  â”‚          â”‚
â”‚  â”‚  :3000 â†’ frontend:80       (Web Dashboard)       â”‚          â”‚
â”‚  â”‚  :5000 â†’ streaming:5000    (REST API)            â”‚          â”‚
â”‚  â”‚  :5432 â†’ db:5432           (Database)            â”‚          â”‚
â”‚  â”‚  :15672 â†’ rabbitmq:15672   (RabbitMQ UI)         â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚          â†‘                                                       â”‚
â”‚          â””â”€â”€â”€â”€â”€â†’ Host Machine                                   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  frontend:80     â”‚                                           â”‚
â”‚  â”‚  (Nginx)         â”‚                                           â”‚
â”‚  â”‚                  â”‚                                           â”‚
â”‚  â”‚  â† HTTP/80       â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚  â†’ /api/* proxy  â”‚              â”‚                            â”‚
â”‚  â”‚    to streaming  â”‚              â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                            â”‚
â”‚                                 Browser                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Volume Mounts:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ detection:                                     â”‚
â”‚   Host: ./models/yolo12m-v2.pt                â”‚
â”‚   Container: /models/yolo12m-v2.pt            â”‚
â”‚   Mode: ro (read-only)                        â”‚
â”‚                                               â”‚
â”‚ frame_reader:                                 â”‚
â”‚   Host: ./videos                              â”‚
â”‚   Container: /videos                          â”‚
â”‚   Mode: ro (read-only)                        â”‚
â”‚                                               â”‚
â”‚ db:                                           â”‚
â”‚   Host: pizza_db_data (Docker volume)         â”‚
â”‚   Container: /var/lib/postgresql/data         â”‚
â”‚   Mode: rw (read-write)                       â”‚
â”‚                                               â”‚
â”‚ db (init):                                    â”‚
â”‚   Host: ./services/db/init.sql                â”‚
â”‚   Container: /docker-entrypoint-initdb.d/     â”‚
â”‚   Mode: ro (read-only)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Video Processing Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 VIDEO PROCESSING FLOW                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Input Video: video_1.mp4 (1280Ã—720 @ 30 FPS)

    â”œâ”€ Frame 0: 0ms      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚ Processing Results:   â”‚
    â”‚                    â”‚ â€¢ Detections: 3       â”‚
    â”‚                    â”‚ â€¢ Violations: 0       â”‚
    â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ Frame 6: 200ms    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ (skip 5 frames)    â”‚ Processing Results:   â”‚
    â”‚                    â”‚ â€¢ Detections: 4       â”‚
    â”‚                    â”‚ â€¢ Violations: 0       â”‚
    â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ Frame 12: 400ms   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚ Processing Results:   â”‚
    â”‚                    â”‚ â€¢ Detections: 3       â”‚
    â”‚                    â”‚ â€¢ Violations: 1 âš ï¸    â”‚
    â”‚                    â”‚   Hand on pizza w/o   â”‚
    â”‚                    â”‚   scooper detected    â”‚
    â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ Frame 18: 600ms   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    â”‚ Processing Results:   â”‚
    â”‚                    â”‚ â€¢ Detections: 4       â”‚
    â”‚                    â”‚ â€¢ Violations: 0       â”‚
    â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â””â”€ ...                                      â†’

Frame Skip Configuration:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Video FPS (from file):  30 FPS                       â”‚
â”‚ Desired FPS:             5 FPS                       â”‚
â”‚ Frame Skip Ratio:        30 / 5 = 6                  â”‚
â”‚                                                     â”‚
â”‚ Process:                                             â”‚
â”‚ Frame 0   â†’ Process                                  â”‚
â”‚ Frame 1-5 â†’ Skip                                     â”‚
â”‚ Frame 6   â†’ Process                                  â”‚
â”‚ Frame 7-11â†’ Skip                                     â”‚
â”‚ Frame 12  â†’ Process                                  â”‚
â”‚ ...                                                  â”‚
â”‚                                                     â”‚
â”‚ Time between processed frames: 200ms                 â”‚
â”‚ Expected throughput: 5 frames/second                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Scalability Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            HORIZONTAL SCALING OPTIONS                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Single Instance (Development):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Detection Service (1)                                   â”‚
â”‚  â””â”€ ~100 frames/min processing capacity                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Throughput: ~2-5 videos (5min each) per hour

Scaled Out (Production):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RabbitMQ (Message Queue)                     â”‚
â”‚              Load balances frames across workers                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚              â”‚              â”‚
           â†“              â†“              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Detection 1 â”‚â”‚ Detection 2 â”‚â”‚ Detection 3 â”‚
    â”‚(100 f/min) â”‚â”‚(100 f/min) â”‚â”‚(100 f/min) â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚              â”‚              â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                   PostgreSQL + Streaming

Total Throughput:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1 Detection Service:   ~100 frames/min    â”‚
â”‚ 3 Detection Services:  ~300 frames/min    â”‚
â”‚ 5 Detection Services:  ~500 frames/min    â”‚
â”‚                                           â”‚
â”‚ Scales linearly with number of workers   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GPU Acceleration (optional):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Single GPU Service:   ~500-800 f/min      â”‚
â”‚ Multiple GPU Service: ~1500+ f/min        â”‚
â”‚                                           â”‚
â”‚ Trade-off: Cost vs Speed                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Database Query Patterns

```
Common Queries and Their Performance:

1. Get Violations by Video (INDEXED)
   SELECT * FROM violations 
   WHERE video_name = 'video_1'
   ORDER BY frame_id DESC
   LIMIT 100;
   
   Performance: ~10ms (indexed on video_name)
   Use: Fetch history for specific video

2. Count Violations (GROUP BY)
   SELECT video_name, COUNT(*) as count
   FROM violations
   GROUP BY video_name
   ORDER BY count DESC;
   
   Performance: ~50ms (full scan)
   Use: Summary statistics

3. Timeline Analysis (INDEXED)
   SELECT timestamp, violation_type, COUNT(*)
   FROM violations
   WHERE timestamp > NOW() - INTERVAL '1 day'
   GROUP BY timestamp, violation_type;
   
   Performance: ~100ms (indexed on timestamp)
   Use: Trend analysis

4. Recent Violations (INDEXED)
   SELECT * FROM violations
   WHERE created_at > NOW() - INTERVAL '1 hour'
   ORDER BY created_at DESC;
   
   Performance: ~20ms (indexed on timestamp)
   Use: Real-time monitoring

Index Strategy:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ idx_violations_video_name          â”‚
â”‚  â†’ Fast filtering by video         â”‚
â”‚  â†’ Most common query type          â”‚
â”‚                                    â”‚
â”‚ idx_violations_timestamp           â”‚
â”‚  â†’ Fast time-range queries         â”‚
â”‚  â†’ Trend analysis                  â”‚
â”‚                                    â”‚
â”‚ (Potential future)                 â”‚
â”‚ idx_violations_video_timestamp     â”‚
â”‚  â†’ Combined search efficiency      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Error Handling & Recovery

```
Service Failure Scenarios:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scenario: RabbitMQ Connection Loss                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ Detection Service:                                       â”‚
â”‚  1. Detect connection error                             â”‚
â”‚  2. Retry with exponential backoff (1s, 2s, 4s, 8s...)â”‚
â”‚  3. Max retries: 5                                      â”‚
â”‚  4. If fails: Container auto-restarts (unless-stopped) â”‚
â”‚  5. Resume processing on reconnection                   â”‚
â”‚                                                          â”‚
â”‚ Impact: ~10-30 second downtime, messages not lost       â”‚
â”‚         (RabbitMQ durability ensures replay)            â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scenario: PostgreSQL Connection Loss                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ Detection Service:                                       â”‚
â”‚  1. Detect connection error on INSERT                   â”‚
â”‚  2. Message NOT acknowledged to RabbitMQ                â”‚
â”‚  3. Message requeued (negative acknowledgment)          â”‚
â”‚  4. Retry on next connection attempt                    â”‚
â”‚  5. Exponential backoff applied                         â”‚
â”‚                                                          â”‚
â”‚ Impact: Violations temporarily not stored, but          â”‚
â”‚         detection still runs, auto-recovery             â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scenario: YOLO Model Load Failure                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ Detection Service:                                       â”‚
â”‚  1. Check model file at startup                         â”‚
â”‚  2. If missing: Error logged, sys.exit(1)               â”‚
â”‚  3. Docker container fails                              â”‚
â”‚  4. Auto-restart triggered (unless-stopped policy)      â”‚
â”‚  5. Check for model file before restart                 â”‚
â”‚                                                          â”‚
â”‚ Solutions:                                               â”‚
â”‚  â€¢ Verify: docker exec pizza_detection ls -la /models   â”‚
â”‚  â€¢ Copy model: docker cp yolo12m-v2.pt <container>:/    â”‚
â”‚  â€¢ Rebuild: docker-compose down && docker-compose up -d â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scenario: Out of Memory                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ Detection Service (~3GB baseline):                       â”‚
â”‚  1. YOLO model: ~500MB (loaded once)                    â”‚
â”‚  2. Frame buffer: ~5MB (1280Ã—720Ã—3 bytes)               â”‚
â”‚  3. Processing overhead: ~1-2GB                         â”‚
â”‚                                                          â”‚
â”‚ Prevention:                                              â”‚
â”‚  â€¢ Monitor: docker stats                                â”‚
â”‚  â€¢ Memory limits: Set in docker-compose.yaml            â”‚
â”‚  â€¢ Scale out: Deploy multiple detection services        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Health Check Flow:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RabbitMQ (:5672)                        â”‚
â”‚ â”œâ”€ Command: rabbitmq-diagnostics ping   â”‚
â”‚ â”œâ”€ Interval: 10s                        â”‚
â”‚ â”œâ”€ Timeout: 30s                         â”‚
â”‚ â””â”€ Retries: 10                          â”‚
â”‚                                         â”‚
â”‚ PostgreSQL (:5432)                      â”‚
â”‚ â”œâ”€ Command: pg_isready -U pizza_user    â”‚
â”‚ â”œâ”€ Interval: 10s                        â”‚
â”‚ â”œâ”€ Timeout: 5s                          â”‚
â”‚ â””â”€ Retries: 10                          â”‚
â”‚                                         â”‚
â”‚ Dependent Services (detection, ...)     â”‚
â”‚ â”œâ”€ Wait for: RabbitMQ and DB healthy    â”‚
â”‚ â”œâ”€ Start only after dependencies ready  â”‚
â”‚ â””â”€ Restart policy: unless-stopped       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. Performance Monitoring

```
Key Metrics to Track:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROCESSING LATENCY                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Frame Extraction:      15-25ms   (Video I/O)          â”‚
â”‚ YOLO Inference:        100-200ms (CPU) / 30-50ms (GPU)â”‚
â”‚ Violation Check:       5-10ms    (Logic)              â”‚
â”‚ Database Write:        50-100ms  (Network + Disk)     â”‚
â”‚ Result Publishing:     5-10ms    (RabbitMQ)           â”‚
â”‚ Cache Update:          <1ms      (In-memory)          â”‚
â”‚ API Response:          <5ms      (REST)               â”‚
â”‚                        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚ Total (per frame):     175-345ms                      â”‚
â”‚                                                        â”‚
â”‚ At 5 FPS: 5 Ã— 345ms = 1.7s per cycle                 â”‚
â”‚ Comfortable processing time headroom                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RESOURCE UTILIZATION                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Detection Service:                                     â”‚
â”‚ â€¢ CPU: 1-2 cores average (3-4 cores peak)            â”‚
â”‚ â€¢ Memory: 3GB baseline + 1GB per concurrent frame     â”‚
â”‚ â€¢ Network: ~5Mbps average (depends on frame size)     â”‚
â”‚                                                        â”‚
â”‚ Streaming Service:                                     â”‚
â”‚ â€¢ CPU: <0.5 cores (mostly I/O waiting)               â”‚
â”‚ â€¢ Memory: 256MB + cache size                          â”‚
â”‚ â€¢ Network: <1Mbps                                     â”‚
â”‚                                                        â”‚
â”‚ PostgreSQL:                                            â”‚
â”‚ â€¢ CPU: 0.5-1 core for inserts                        â”‚
â”‚ â€¢ Memory: Shared buffer + query cache                 â”‚
â”‚ â€¢ Storage: ~1MB per 1000 violations                   â”‚
â”‚                                                        â”‚
â”‚ Frame Reader:                                          â”‚
â”‚ â€¢ CPU: 1 core (video I/O bound)                      â”‚
â”‚ â€¢ Memory: 512MB (frame buffers)                       â”‚
â”‚ â€¢ Storage: Read from video files                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ THROUGHPUT METRICS                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Frame Processing:      5 frames/sec (configurable)    â”‚
â”‚ Violation Detection:    0-N per frame (event-driven)   â”‚
â”‚ Database Writes:       100+ violations/sec capacity   â”‚
â”‚ API Requests:         1000+ req/sec capacity          â”‚
â”‚                                                        â”‚
â”‚ Bottleneck Analysis:                                   â”‚
â”‚ â€¢ Single Detection:    ~100 frames/min                â”‚
â”‚ â€¢ Scaled (N nodes):    ~100N frames/min               â”‚
â”‚ â€¢ Database:           Rarely the bottleneck           â”‚
â”‚ â€¢ RabbitMQ:           High throughput, rarely limited â”‚
â”‚ â€¢ Frontend:           Client-side polling, low impact â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Monitoring Dashboard (Prometheus):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service Health:                                        â”‚
â”‚ â€¢ Detection service UP time                           â”‚
â”‚ â€¢ RabbitMQ queue depth                                â”‚
â”‚ â€¢ PostgreSQL connection pool usage                    â”‚
â”‚                                                        â”‚
â”‚ Processing Metrics:                                    â”‚
â”‚ â€¢ Frames processed per minute                         â”‚
â”‚ â€¢ Violations detected per video                       â”‚
â”‚ â€¢ Average detection latency                           â”‚
â”‚                                                        â”‚
â”‚ Resource Metrics:                                      â”‚
â”‚ â€¢ CPU usage per container                             â”‚
â”‚ â€¢ Memory usage trend                                  â”‚
â”‚ â€¢ Disk I/O (database & logs)                          â”‚
â”‚                                                        â”‚
â”‚ API Metrics:                                           â”‚
â”‚ â€¢ Request rate                                        â”‚
â”‚ â€¢ Response time percentiles (p50, p95, p99)          â”‚
â”‚ â€¢ Error rates                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Conclusion

These diagrams provide a complete visual representation of the PIZZA-MONITOR microservices architecture. They show:

- **System Overview**: How all components connect
- **Message Flow**: Data movement between services
- **Data Structures**: Format of data at each stage
- **Dependencies**: Service coupling and relationships
- **Networking**: Container and port configuration
- **Processing Pipeline**: Video processing workflow
- **Scalability**: How to scale components
- **Performance**: Expected latency and throughput
- **Monitoring**: Key metrics to track

For implementation details, refer to the main README.md and ARCHITECTURE.md documents.
